{
    "collab_server" : "",
    "contents" : "rm(list=ls())\n\n\n#setwd\n\nsetwd(\"/Users/shaunratcliff/Dropbox/Academia/Teaching/ACSPRI/Summer 2018/Data/Smoking\")\n\n#load data\n\nsmoke.data <- read.csv(\"smoke_data.csv\")\n\n#reshape data\n\nhead(smoke.data)\n\nlibrary(reshape2)\n\nsmoke.data2 <- dcast(smoke.data, newid + parsmk + sex.1.F. ~ wave, value.var=\"smkreg\")\nsmoke.data3 <- melt(smoke.data2, id.vars=c(\"newid\", \"parsmk\", \"sex.1.F.\"))\n\n\n#Load packages\n\nlibrary(scales)\nlibrary(directlabels)\n\n#recode parents smoking behaviour \n\nsmoke.trend.2$parents <- as.factor(smoke.trend.2$parsmk)\nlevels(smoke.trend.2$parents) <- c(\"Non-smokers\", \"Smokers\")\n\n\n#create plot \n\nggplot(smoke.trend.2, aes(x = wave, y = smoke, \n                          colour=parents, \n                          group=parents)) + \n  geom_line() + \n  geom_dl(aes(label=parents), method=last.qp) +\n  labs(title = \"Percentage of adolescents\\n who reported smoking\",\n       y = \"Proportion of smokers\",\n       x = \"Survey wave\") +\n  scale_y_continuous(labels = percent, limits = c(0,.3),\n                     breaks=c(.05, .15, .25)) +\n  scale_x_continuous(limits = c(1,7), breaks = c(2,3,4,5)) + \n  theme_bw() +\n  theme(legend.position=\"none\",\n        axis.text = element_text(size=10),\n        plot.title = element_text(size=10, hjust = .5,\n                               face=\"bold\"))\n\n\n\n#calculating confidence intervals \n\nestimate <- table(smoke.data$smkreg)[2] / length(smoke.data$smkreg)\nse <- sqrt(estimate * (1-estimate) / length(smoke.data$smkreg))\nint.95 <- estimate + qnorm(c(.025, .975))*se\n\nlibrary(Rmisc)\nCI(smoke.data$smkreg, ci = .95)\n\n\nsmoke.trend.3 <- ddply(smoke.data, .(wave, parsmk), summarise,\n      smoke = CI(smkreg, ci = .95)[2],\n      upper.ci = CI(smkreg, ci = .95)[1],\n      lower.ci = CI(smkreg, ci = .95)[3])\n\n\nsmoke.trend.3$parents <- as.factor(smoke.trend.3$parsmk)\nlevels(smoke.trend.3$parents) <- c(\"Non-smokers\", \"Smokers\")\n\n#Plot this \n\n\nggplot(smoke.trend.3, aes(x = wave, y = smoke, \n                          colour=parents, \n                          group=parents)) + \n  geom_line() + \n  geom_dl(aes(label=parents), method=last.qp) +\n  geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), alpha=.1, colour=NA) +\n  labs(title = \"Percentage of adolescents\\n who reported smoking\",\n       y = \"Proportion of smokers\",\n       x = \"Survey wave\") +\n  scale_y_continuous(labels = percent, limits = c(0,.3),\n                     breaks=c(.05, .15, .25)) +\n  scale_x_continuous(limits = c(1,7), breaks = c(2,3,4,5)) + \n  theme_bw() +\n  theme(legend.position=\"none\",\n        axis.text = element_text(size=10),\n        plot.title = element_text(size=10, hjust = .5,\n                                  face=\"bold\"))\n\n\n### By gender \n\n\nsmoke.trend.4 <- ddply(smoke.data, .(wave, parsmk, sex.1.F.), summarize, \n                       smoke =  round(CI(smkreg , ci = 0.95)[2], 2),\n                       upper.ci =  round(CI(smkreg , ci = 0.95)[1], 2),\n                       lower.ci =  round(CI(smkreg , ci = 0.95)[3], 2))\n\nsmoke.trend.4$parents <- as.factor(smoke.trend.4$parsmk)\nlevels(smoke.trend.4$parents) <- c(\"Non-smokers\", \"Smokers\")\n\nsmoke.trend.4$gender <- as.factor(smoke.trend.4$sex.1.F.)\nlevels(smoke.trend.4$gender) <- c(\"Male\", \"Female\")\n\n\n\nsmoke.graph.1 <- ggplot(smoke.trend.4, aes(x = wave, y = smoke, \n                          colour=parents, \n                          group=parents)) + \n  geom_line() + \n  geom_dl(aes(label=parents), method=last.qp) +\n  geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), alpha=.1, colour=NA) +\n  labs(title = \"Percentage of adolescents\\n who reported smoking\",\n       y = \"Proportion of smokers\",\n       x = \"Survey wave\") +\n  scale_y_continuous(labels = percent, limits = c(0,.4),\n                     breaks=c(.05, .15, .25)) +\n  scale_x_continuous(limits = c(1,7), breaks = c(2,3,4,5)) + \n  theme_bw() +\n  theme(legend.position=\"none\",\n        axis.text = element_text(size=10),\n        plot.title = element_text(size=10, hjust = .5,\n                                  face=\"bold\")) +\n  facet_grid(parents~ gender)\n\ntiff(file=\"./ smoke.graph.1.tiff\", width=500, height=500)\n\nprint(smoke.graph.1) \t\n\naux <- dev.off() \t\t#closes off the command\n\n\nsave.image(\"smoking.analysis.RData\")\nload(\"smoking.analysis.RData\")",
    "created" : 1516073543272.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2741450492",
    "id" : "62F2F0BF",
    "lastKnownWriteTime" : 1516074679,
    "last_content_update" : 1516074679914,
    "path" : "~/Dropbox/Academia/Teaching/ACSPRI/Summer 2018/Data/Smoking/smoking analysis.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}